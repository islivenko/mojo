# Project Roadmap - Bergermann

> **–ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –¥–æ—Ä–∞–±–æ—Ç–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ Bitrix24**
> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2026-01-03 | –í–µ—Ä—Å–∏—è: 2.4



---

## üìä –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (11 –∑–∞–¥–∞—á)
- OAuth 2.0 –∏ token refresh –¥–ª—è Bitrix24
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è SPA "Cudzoziemcy" —Å Contact (3 —Ç–∏–ø–∞ —Å–≤—è–∑–µ–π)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π Contact (Paszport, Data urodzin, Nazwisko imiƒô)
- Daily sync –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö Cudzoziemcy
- **Bitrix24 OCR - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** ‚ú®
  - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–∞—Å–ø–æ—Ä—Ç–æ–≤ (Document AI + Gemini)
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 8 –ø–æ–ª–µ–π Contact –∏–∑ OCR –¥–∞–Ω–Ω—ã—Ö
  - Timeline notifications —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ enum (242 —Å—Ç—Ä–∞–Ω—ã)
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: passport-ocr ‚Üí b24-ocr** ‚ú®
  - –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
  - –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **b24-contact-files-processor - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** ‚ú®
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ Contact ‚Üí SPA Za≈ÇƒÖczniki
  - 8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å AI-–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–µ–π
  - Timeline countdown —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π
  - Fallback –¥–ª—è –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (DOCX, ZIP)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞
  - 100% –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤

### üöÄ –í —Ä–∞–±–æ—Ç–µ (0 –∑–∞–¥–∞—á)
_–í—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã_

### üìã –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ (7 –∑–∞–¥–∞—á)
**P0 - –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (0):**
_–í—Å–µ –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã_

**P1 - –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (5):**
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –º–∞–Ω—É–∞–ª–∞–º–∏ (6 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) ‚ú®
- –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –º–∞–Ω—É–∞–ª–∞ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ª—É—á—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

**P2 - –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (2):**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìà –î–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

#### 1. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth 2.0 –¥–ª—è Bitrix24
- [x] Token refresh Cloud Function
- [x] Secret Manager –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

#### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è SPA Cudzoziemcy (1038)
- [x] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Contact —á–µ—Ä–µ–∑ webhook handler + Pub/Sub worker
- [x] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π: Podstawy pobytu (1050), Umowy (1070), Uprawnienia do pracy (1046)
- [x] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö items (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ SUCCESS/FAIL stages)
- [x] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π Contact: Paszport, Data urodzin, Nazwisko imiƒô kandydata
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ title: "{LAST_NAME} {NAME} ‚Ä¢ Sprawa nr. {ID}"
- [x] Daily sync –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö Cudzoziemcy (Cloud Scheduler)

#### 3. Bitrix24 OCR - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚ú®
- [x] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: webhook handler + Pub/Sub worker
- [x] Document AI OCR –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- [x] Gemini AI –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [x] Timeline notifications —Å countdown –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- [x] –û–±–æ–≥–∞—â–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
- [x] **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Contact –∏–∑ OCR –¥–∞–Ω–Ω—ã—Ö** (commit: a67c451)
  - [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 8 –ø–æ–ª–µ–π Contact:
    - Nazwisko (LAST_NAME)
    - Imiƒô (NAME)
    - Data urodzin (BIRTHDATE)
    - Obywatelstwo (UF_CRM_1765736453701)
    - P≈Çeƒá (UF_CRM_1765737151979)
    - Paszport (UF_CRM_1765737216852)
    - Data wydania paszportu (UF_CRM_1765737246457)
    - Data wa≈ºno≈õci paszportu (UF_CRM_1765737266613)
  - [x] –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ (—Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ –ø–æ–ª—è)
  - [x] –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ç–∞–π–º–ª–∞–π–Ω Contact
  - [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ enum –∏–∑ Bitrix24 (242 —Å—Ç—Ä–∞–Ω—ã, 2 –ø–æ–ª–∞)
  - [x] –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–∞–π–º–ª–∞–π–Ω–µ (Ukraina –≤–º–µ—Å—Ç–æ 490)
  - [x] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏ OCR –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–π–º–ª–∞–π–Ω–µ

#### 4. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: passport-ocr ‚Üí b24-ocr ‚ú®
- [x] **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏** (2026-01-03)
  - [x] –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `google-cloud/b24-ocr/`
  - [x] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã Cloud Functions:
    - `passport-ocr-http` ‚Üí `b24-ocr-http`
    - `passport-ocr-worker` ‚Üí `b24-ocr-worker`
  - [x] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω Pub/Sub topic: `passport-ocr-events` ‚Üí `b24-ocr-events`
  - [x] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω —Å–µ—Ä–≤–∏—Å: `passport_parser.py` ‚Üí `document_parser.py`
  - [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —Å—Å—ã–ª–∫–∏ –≤ –∫–æ–¥–µ
  - [x] –ó–∞–¥–µ–ø–ª–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  - [x] –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  - [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
    - `passport-ocr-architecture.md` ‚Üí `b24-ocr-architecture.md`
    - `passport-ocr-logging.md` ‚Üí `b24-ocr-logging.md`
  - [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –≤–æ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- üéØ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ Bitrix24 –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `b24-`
- üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: `document_parser.py` –≥–æ—Ç–æ–≤ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- üîß –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å: –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `parse_document_data(document_type="passport")`
- üìö –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Bitrix24 OCR:**
```
SPA Za≈ÇƒÖczniki (1054) webhook
    ‚Üì
b24-ocr-http (HTTP handler)
    ‚Üì Pub/Sub (b24-ocr-events)
b24-ocr-worker
    ‚Üì
1. Download file from Bitrix24
2. Document AI OCR (text extraction)
3. Gemini AI parsing (structured data)
4. Update Contact fields (—Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ) ‚úÖ
5. Post timeline to Contact (—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏) ‚úÖ
6. Post timeline to SPA Za≈ÇƒÖczniki
```

#### 5. b24-contact-files-processor - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ Contact ‚Üí SPA Za≈ÇƒÖczniki ‚ú®
- [x] **–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (2026-01-03)
  - [x] HTTP handler –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ Business Process
  - [x] Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏–∑ Contact Pliki field
  - [x] Timeline countdown (60s, –∏–Ω—Ç–µ—Ä–≤–∞–ª 10s) —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π
  - [x] AI-–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π):
    - PASSPORT (570), RESIDENCE_CARD (576), STEMPEL (582), DECYZJA (584)
    - NOTIFICATION (580), PESEL (572), VISA (574), OTHER (578)
  - [x] Fallback –¥–ª—è –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (DOCX, ZIP)
  - [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (lastname-firstname_category.ext)
  - [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - [x] –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ Timeline
  - [x] Production tested: 100% success rate (8/8 files, 54.4s)
  - [x] –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `b24-timeline-files-processor`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Google Document AI (OCR)
- Gemini 2.0 Flash Exp (AI categorization, confidence 0.80-0.95)
- 8 —Å–µ—Ä–≤–∏—Å–æ–≤ (536 lines main.py, 191 lines prompts, 288 lines timeline)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ b24-contact-files-processor:**
```
Contact Pliki field (multiple files)
    ‚Üì Manual BP trigger
b24-contact-files-processor-http
    ‚Üì Pub/Sub (b24-contact-files-processor-events)
b24-contact-files-processor-worker
    ‚Üì
1. Start Timeline countdown (60s)
2. Get files from Contact Pliki field
3. For each file:
   a. Download file (extract original filename)
   b. Try OCR (Document AI)
      ‚Ä¢ Success ‚Üí AI categorization (Gemini)
      ‚Ä¢ Failure ‚Üí category "Inne (bez OCR)"
   c. Generate new filename (lastname-firstname_category.ext)
   d. Create SPA Za≈ÇƒÖczniki
   e. Upload file with new name
   f. Track processed file ID
4. Remove all processed files from Contact
5. Stop countdown, cleanup intermediate messages
6. Post final summary to Contact timeline
```

---

## üöÄ –í —Ä–∞–±–æ—Ç–µ

_–í—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã_

---

## üìã –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –º–∞–Ω—É–∞–ª–∞ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é

**–°—Ç–∞—Ç—É—Å:** üî¥ –ù–µ –Ω–∞—á–∞—Ç–æ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å best practices –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö Google Cloud Functions –≤ –ø—Ä–æ–µ–∫—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É—è `docs/b24-ocr-logging.md` –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω.

**–¶–µ–ª—å:**
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥ –∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å onboarding –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: `docs/logging-best-practices.md`**

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

#### 1. –í–≤–µ–¥–µ–Ω–∏–µ
- –ó–∞—á–µ–º –Ω—É–∂–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ JSON —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è Cloud Logging
- –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

#### 2. StructuredLogHandler - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞
```python
class StructuredLogHandler(logging.Handler):
    """Custom handler that outputs structured JSON logs for Cloud Run"""
    def emit(self, record):
        log_entry = {
            "severity": record.levelname,
            "message": record.getMessage(),
            "timestamp": datetime.utcnow().isoformat() + "Z",
            "logger": record.name,
        }
        print(json.dumps(log_entry, ensure_ascii=False, default=str), flush=True)
```

#### 3. –≠–º–æ–¥–∑–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞)
- üî§ OCR –æ–ø–µ—Ä–∞—Ü–∏–∏
- ü§ñ AI/ML –æ–ø–µ—Ä–∞—Ü–∏–∏
- üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (GET, fetch)
- üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (POST, update)
- üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- üì® Webhook/Message –ø–æ–ª—É—á–µ–Ω
- üìã –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
- üîç –ü–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- ‚¨áÔ∏è Download
- ‚¨ÜÔ∏è Upload
- ‚úÖ –£—Å–ø–µ—Ö
- ‚ùå –û—à–∏–±–∫–∞
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- üßπ Cleanup
- ‚è±Ô∏è Timing/countdown
- üìù –ó–∞–ø–∏—Å—å/—Å–æ–∑–¥–∞–Ω–∏–µ
- üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ
- üöÄ –°—Ç–∞—Ä—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞
- üéØ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

#### 4. –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **INFO**: –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏, —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **WARNING**: –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- **ERROR**: –û—à–∏–±–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è

#### 5. –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**b24-ocr-worker:**
```
üî§ OCR starting: 140362 bytes (137.1KB), mime: application/pdf
‚úÖ OCR completed successfully: 1 pages, 1266 chars, 2.06s
ü§ñ Starting Gemini AI parsing: 1266 chars
‚úÖ Successfully extracted 9 fields
```

**b24-spa-1038-sync-worker:**
```
üîÑ Syncing Podstawy pobytu to Cudzoziemcy
üì• Fetching active items for contact_id=208
‚úÖ Updated Cudzoziemcy item 10: linked 2 active Podstawy pobytu
```

**b24-token-refresh:**
```
üîÑ Token refresh started
‚úÖ Token refreshed successfully, expires in 3600s
üì§ Token saved to Secret Manager: b24-access-token
```

#### 6. –®–∞–±–ª–æ–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
log("INFO", "=" * 50)
log("INFO", "üì® New message received")
log("INFO", f"üìã Message parsed", msg_data=message)
```

**API –≤—ã–∑–æ–≤—ã:**
```python
logger.info(f"üì• Fetching {entity_type}: id={item_id}")
logger.info(f"‚úÖ Fetched successfully: {len(data)} items")
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤:**
```python
logger.info(f"‚¨áÔ∏è Downloading file: {file_name}")
logger.info(f"‚úÖ Downloaded: {len(content)} bytes ({len(content)/1024:.1f}KB)")
```

**Timing:**
```python
start_time = time.time()
# ... –æ–ø–µ—Ä–∞—Ü–∏—è ...
elapsed = time.time() - start_time
logger.info(f"‚úÖ Completed in {elapsed:.2f}s")
```

**–û—à–∏–±–∫–∏:**
```python
try:
    # ... –∫–æ–¥ ...
except Exception as e:
    logger.error(f"‚ùå Operation failed: {type(e).__name__}: {e}")
    raise
```

#### 7. –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏:**
```bash
gcloud logging read 'resource.labels.service_name="FUNCTION_NAME"' \
  --project=bergermann --limit=50
```

**–§–∏–ª—å—Ç—Ä –ø–æ –æ—à–∏–±–∫–∞–º:**
```bash
gcloud logging read 'resource.labels.service_name="FUNCTION_NAME" AND severity="ERROR"' \
  --project=bergermann --limit=20
```

**–§–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –¥–∏–∞–ø–∞–∑–æ–Ω—É:**
```bash
gcloud logging read 'resource.labels.service_name="FUNCTION_NAME" AND timestamp>="2026-01-03T00:00:00Z"' \
  --project=bergermann --limit=50
```

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–æ–≥–≥–µ—Ä–∞–º:**
```bash
gcloud logging read 'resource.labels.service_name="FUNCTION_NAME"' \
  --project=bergermann --limit=100 --format=json | \
  python3 -c "
import sys, json
logs = json.load(sys.stdin)
by_logger = {}
for log in logs:
    jp = log.get('jsonPayload', {})
    if 'logger' in jp:
        logger = jp['logger'].split('.')[-1]
        by_logger.setdefault(logger, []).append(jp['message'])
for logger, messages in by_logger.items():
    print(f'{logger}: {len(messages)} logs')
"
```

#### 8. Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è StructuredLogHandler
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å INFO –∏–ª–∏ –Ω–∏–∂–µ)

**–ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã**
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ª–æ–≥–≥–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç root logger configuration
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ print() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç flush=True

**–ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤**
- –£–±—Ä–∞—Ç—å print() –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è logger.info()
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ handler –¥–æ–±–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

#### 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- Processing time (–≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- Error rate (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫)
- Success rate (–ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
- API response time (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–ª–µ—Ä—Ç—ã:**
- Error rate > 5% –∑–∞ 5 –º–∏–Ω—É—Ç
- Processing time > 30 —Å–µ–∫—É–Ω–¥
- API failures > 10 –∑–∞ 5 –º–∏–Ω—É—Ç
- Function invocation failures

#### 10. –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π Cloud Function:
- [ ] –î–æ–±–∞–≤–∏—Ç—å StructuredLogHandler –≤ main.py
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã (INFO level)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å timing –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–≥–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –ª–æ–≥–æ–≤ –≤ Cloud Console
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ª–æ–≥–æ–≤

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª: `docs/logging-best-practices.md`
- –û–±–Ω–æ–≤–∏—Ç—å `README.md` —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
- –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è:**
- `b24-ocr-worker` - –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å OCR –∏ AI
- `b24-spa-1038-sync-worker` - –ø—Ä–∏–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `b24-token-refresh` - –ø—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- `b24-spa-1038-http` - –ø—Ä–∏–º–µ—Ä webhook handler

---

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –º–∞–Ω—É–∞–ª–∞–º–∏

**–°—Ç–∞—Ç—É—Å:** üî¥ –ù–µ –Ω–∞—á–∞—Ç–æ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `docs/manuals/` —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –º–∞–Ω—É–∞–ª–∞–º–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º –∞—Å–ø–µ–∫—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è onboarding –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

**–¶–µ–ª—å:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞
- –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞–Ω–∏–π –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Ö–æ–¥–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**

```
docs/manuals/
‚îú‚îÄ‚îÄ README.md                      # –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞–Ω—É–∞–ª–æ–≤
‚îú‚îÄ‚îÄ logging-guide.md               # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é
‚îú‚îÄ‚îÄ oauth-setup.md                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth 2.0 –¥–ª—è Bitrix24
‚îú‚îÄ‚îÄ gcs-project-structure.md       # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Google Cloud
‚îú‚îÄ‚îÄ deployment-guide.md            # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é —Ñ—É–Ω–∫—Ü–∏–π
‚îú‚îÄ‚îÄ bitrix24-api-reference.md      # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ Bitrix24 REST API
‚îî‚îÄ‚îÄ troubleshooting.md             # –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
```

**–î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**

#### 4.1. `logging-guide.md`
–ù–∞ –±–∞–∑–µ `docs/b24-ocr-logging.md`, –æ–±–æ–±—â–µ–Ω–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π:
- –í–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- StructuredLogHandler - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞
- –≠–º–æ–¥–∑–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)
- –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- –ö–æ–º–∞–Ω–¥—ã gcloud –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏
- Troubleshooting
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

#### 4.2. `oauth-setup.md`
–ù–∞ –±–∞–∑–µ `docs/OAuth-b24.md`, —Å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Bitrix24
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- –û–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ access_token –∏ refresh_token
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ Secret Manager
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã OAuth
- –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

#### 4.3. `gcs-project-structure.md`
–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:
- –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- Cloud Functions –∏ –∏—Ö —Ä–æ–ª–∏
- Pub/Sub topics
- Secret Manager secrets
- Cloud Scheduler jobs
- –î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### 4.4. `deployment-guide.md`
–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ gcloud CLI
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ GCP
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π (–ø–æ—à–∞–≥–æ–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–π)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è

#### 4.5. `bitrix24-api-reference.md`
–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (OAuth 2.0)
- CRM –º–µ—Ç–æ–¥—ã (item.get, item.update, contact.get, etc.)
- SPA Entities –≤ –ø—Ä–æ–µ–∫—Ç–µ (1038, 1046, 1050, 1054, 1070)
- –ü–æ–ª—è Contact (—Å –∫–æ–¥–∞–º–∏ UF_CRM_*)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhooks
- Rate limits (50 req/sec)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

#### 4.6. `troubleshooting.md`
–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:
- OAuth –æ—à–∏–±–∫–∏ (expired_token, invalid_grant, etc.)
- API –æ—à–∏–±–∫–∏ (400, 403, 404, 429)
- –ü—Ä–æ–±–ª–µ–º—ã —Å Cloud Functions
- –ü—Ä–æ–±–ª–µ–º—ã —Å Pub/Sub
- –ö–∞–∫ —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- –ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é

**–ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
   - [ ] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `docs/manuals/`
   - [ ] –°–æ–∑–¥–∞—Ç—å `README.md` —Å –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ–º

2. **–°–æ–∑–¥–∞–Ω–∏–µ –º–∞–Ω—É–∞–ª–æ–≤:**
   - [ ] `logging-guide.md` - –Ω–∞ –±–∞–∑–µ `b24-ocr-logging.md`
   - [ ] `oauth-setup.md` - –Ω–∞ –±–∞–∑–µ `OAuth-b24.md`
   - [ ] `gcs-project-structure.md` - –Ω–æ–≤—ã–π
   - [ ] `deployment-guide.md` - –Ω–æ–≤—ã–π
   - [ ] `bitrix24-api-reference.md` - –Ω–æ–≤—ã–π
   - [ ] `troubleshooting.md` - –Ω–æ–≤—ã–π

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –≤ `docs/architecture.md`
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –≤ `docs/google-cloud.md`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ `docs/manuals/` –≤ –≥–ª–∞–≤–Ω—ã–π README

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ markdown

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–°—Ä–µ–¥–Ω–∏–π)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –ó–∞–¥–∞—á–∞ #3 (–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –º–∞–Ω—É–∞–ª–∞ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é) –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∞ —Å —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π

**–ü–æ–ª—å–∑–∞:**
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π onboarding –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Ö–æ–¥–æ–≤

---

### 5. –£–ª—É—á—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–°—Ç–∞—Ç—É—Å:** üî¥ –ù–µ –Ω–∞—á–∞—Ç–æ

#### 5.1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cloud Monitoring dashboards
- [ ] –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –æ—à–∏–±–æ–∫
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] Cost tracking

#### 5.2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit tests –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Integration tests
- [ ] Load testing –¥–ª—è OCR —Ñ—É–Ω–∫—Ü–∏–π

#### 5.3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

#### 5.4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- [ ] Batch API calls –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ Cloud Functions
- [ ] CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (P0)
1. ‚úÖ Bitrix24 OCR - –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –ª–æ–≥–æ–≤
2. ‚úÖ Bitrix24 OCR - –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ Contact
3. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: passport-ocr ‚Üí b24-ocr (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å)
4. üî¥ –ü–µ—Ä–µ–Ω–æ—Å —Ñ–∞–π–ª–æ–≤ - —ç—Ç–∞–ø—ã 2.1-2.2 (OCR + –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (P1)
1. üî¥ –ü–µ—Ä–µ–Ω–æ—Å —Ñ–∞–π–ª–æ–≤ - —ç—Ç–∞–ø—ã 2.3-2.5 (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ + –∑–∞–≥—Ä—É–∑–∫–∞)
2. üî¥ –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –º–∞–Ω—É–∞–ª–∞ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é
3. üî¥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
4. üî¥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (P2)
1. üî¥ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
2. üî¥ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Cloud Platform:** Google Cloud Platform
- **Compute:** Cloud Functions (2nd gen)
- **Messaging:** Cloud Pub/Sub
- **Storage:** Cloud Secret Manager
- **AI/ML:**
  - Document AI (OCR)
  - Gemini AI (parsing, categorization)
- **Integration:** Bitrix24 REST API
- **Language:** Python 3.14
- **Logging:** Cloud Logging (structured JSON)

### Bitrix24 Entities
- **Contacts** - –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- **SPA Cudzoziemcy (1038)** - –¥–µ–ª–∞ –∏–Ω–æ—Å—Ç—Ä–∞–Ω—Ü–µ–≤
- **SPA Podstawy pobytu (1050)** - –æ—Å–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è
- **SPA Umowy (1070)** - –¥–æ–≥–æ–≤–æ—Ä—ã
- **SPA Uprawnienia do pracy (1046)** - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —Ä–∞–±–æ—Ç—É
- **SPA Za≈ÇƒÖczniki (1054)** - –≤–ª–æ–∂–µ–Ω–∏—è/–¥–æ–∫—É–º–µ–Ω—Ç—ã

---

## üìù –ó–∞–º–µ—Ç–∫–∏

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# Bitrix24 OCR worker
gcloud logging read 'resource.labels.service_name="b24-ocr-worker"' \
  --project=bergermann --limit=50

# –§–∏–ª—å—Ç—Ä –ø–æ –æ—à–∏–±–∫–∞–º
gcloud logging read 'resource.labels.service_name="b24-ocr-worker" AND severity="ERROR"' \
  --project=bergermann --limit=20
```

#### –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π
```bash
# Bitrix24 OCR
cd google-cloud/b24-ocr/b24-ocr-worker && ./deploy.sh
cd google-cloud/b24-ocr/b24-ocr-http && ./deploy.sh

# SPA Sync
cd google-cloud/b24-spa-1038-sync/b24-spa-1038-sync-worker && ./deploy.sh
cd google-cloud/b24-spa-1038-sync/b24-spa-1038-http && ./deploy.sh
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# Trigger Bitrix24 OCR
curl "https://europe-central2-bergermann.cloudfunctions.net/b24-ocr-http?type_1054_id=6"

# Trigger SPA sync
curl "https://europe-central2-bergermann.cloudfunctions.net/b24-spa-1038-http" \
  -d "event=ONCRMDYNAMICITEMUPDATE&data[FIELDS][ID]=10"
```

### –í–∞–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [Bitrix24 REST API](https://training.bitrix24.com/rest_help/)
- [Document AI Documentation](https://cloud.google.com/document-ai/docs)
- [Gemini API Documentation](https://ai.google.dev/docs)
- [Cloud Functions Documentation](https://cloud.google.com/functions/docs)

---

## üìÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2026-01-03
- ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: passport-ocr ‚Üí b24-ocr**
  - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤—Å–µ Cloud Functions –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Contact –∏–∑ OCR –¥–∞–Ω–Ω—ã—Ö**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 8 –ø–æ–ª–µ–π Contact
  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ enum (242 —Å—Ç—Ä–∞–Ω—ã)
  - Timeline notifications —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- ‚úÖ –û–±–æ–≥–∞—â–µ–Ω—ã –ª–æ–≥–∏ –¥–ª—è b24-ocr-worker
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π StructuredLogHandler
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/b24-ocr-logging.md`

### 2026-01-02
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Bitrix24 OCR —Å Document AI + Gemini
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω Timeline Notifier —Å countdown
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤ –∏–∑ SPA

### 2025-12-XX
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è SPA Cudzoziemcy
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ daily sync —Ñ—É–Ω–∫—Ü–∏—è
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π Contact

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-03
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.3
